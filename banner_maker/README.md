# AI Banner Maker - 次世代インテリジェントクリエイティブプラットフォーム

🚀 **革新的LLMスクレイピング統合** による最先端AI搭載のコンテンツ分析、構造化データ抽出、インテリジェントコピー生成、シームレスCanva連携を実現するプロフェッショナルWebアプリケーション。

## 🎯 機能概要

**入力**: ランディングページURL → **出力**: Canvaで使用可能な整理されたクリエイティブアセット

**例**: `https://www.yodobashi.com/product/12345/` → インテリジェント構造化データ抽出、AI生成マーケティングコピー、クリエイティブインサイト、適切な寸法のCanva空白デザイン

## 🚀 主要機能

### **🧠 革新的LLMインテリジェントスクレイピング**

LLMとPlaywrightの組み合わせは、従来困難だったサイト固有構造の壁を乗り越え、柔軟で高度な情報抽出を実現する有望な手法です。このシステムは単なるHTMLパースを超越し、人間のようにページを理解して情報を抽出します。

#### **🔬 従来手法との技術的差別化**

**従来のスクレイピング手法の課題:**
- ✗ **サイト構造依存性**: HTMLの構造変更により即座に機能停止（構造的脆弱性）
- ✗ **動的コンテンツ限界**: JavaScriptで生成されるコンテンツへの対応不足
- ✗ **文脈理解の欠如**: 断片的なデータ抽出で意味的な情報把握が困難
- ✗ **個別カスタマイズ必須**: サイトごとに専用の抽出ロジック開発が必要

**本システムの技術的優位性:**
- ✅ **意味理解型抽出**: LLMによるページ内容の文脈理解と意味的情報特定
- ✅ **構造非依存性**: HTMLタグ構造に依存しない内容ベースの情報抽出
- ✅ **動的コンテンツ完全対応**: Playwright + LLMによるJavaScript描画コンテンツの包括的処理
- ✅ **自動構造化**: 非構造化データから12種類の構造化フィールドへの自動分類

#### **🚀 統合ワークフロー - NEW! 🆕**
- **構造化データ抽出**: Gemini 2.5 Flash Liteによる12種類の詳細フィールド抽出
- **リアルタイム可視化**: 抽出プロセス、信頼度スコア、使用手法の完全表示
- **シームレス統合**: すべての後続機能（コピー生成、解説生成）が統一データを活用

#### **🎯 高度な構造化抽出システム**

**実装ファイル**: `/src/llm_scraper.py` - 核となるインテリジェント抽出エンジン

**💰 コスト効率性**: 全ての処理（スクレイピング、コピー生成、解説生成）でGemini 2.5 Flash Liteを使用
- **入力**: 100万トークンあたり **$0.10** （業界最安レベル）
- **出力**: 100万トークンあたり **$0.40** （高品質低コスト）
- **実際のコスト**: 1回の完全処理で約 $0.10

**12種類の詳細フィールド**:
  - 🏷️ **商品名** - メイン商品・サービス名
  - 📄 **商品説明** - 詳細な商品・サービス説明  
  - ⭐ **主要機能** - メイン機能やベネフィットリスト
  - 💲 **価格情報** - 価格、コスト、料金情報
  - 🏢 **ブランド名** - ブランドや企業名
  - 📚 **カテゴリ** - 商品カテゴリや種類
  - 👥 **ターゲット層** - 対象ユーザー・オーディエンス
  - 💎 **独自の強み** - 特別な差別化要因
  - 👆 **コールトゥアクション** - ページが促す主要アクション
  - 📦 **在庫状況** - 利用可能性情報
  - ⚙️ **技術仕様** - 詳細属性・スペック
  - 💬 **レビュー傾向** - レビューの全体的感情

#### **🔬 LLM処理パイプライン詳細解析**

**テストファイル**: `/test_llm_scraper.py` - 実際の処理内容の確認が可能

**Step 1: HTML取得戦略**
```python
# ハイブリッド取得戦略（llm_scraper.py:155-184行）
async def _get_raw_html_with_method(self, url: str) -> tuple[str, str]:
    # 戦略1: Playwright高速試行（5秒以内）
    # 戦略2: Requests偽装アクセス（アンチボット対応）
```

**Step 2: LLM最適化データ前処理**

取得したHTMLコンテンツを、LLMが効率的に処理できるMarkdown形式に変換・最適化します。この前処理により、LLMの解析精度向上とトークン使用量の最適化を実現します。

```python
# HTML→Markdown変換（llm_scraper.py:344-425行）
def _preprocess_html_for_llm(self, html_content: str) -> str:
    # 🧹 ノイズ除去: ナビゲーション、広告、スクリプト等の除去
    # 📝 フォーマット変換: LLM処理に最適化されたMarkdown形式への変換
    # ✂️ トークン最適化: 12,000文字以内での効率的な情報圧縮
```

**LLM投入データの構成**:
Webサイトから収集した生データを以下の手順で構造化・最適化します：
- 🗑️ **ノイズフィルタリング**: ナビゲーション、広告、フッター等の非本質的要素の除去
- 💎 **コアコンテンツ抽出**: 商品情報、価格、説明文等の価値ある情報の選別抽出  
- 📖 **LLM最適化フォーマット**: 解析精度を向上させるMarkdown形式への変換
- **🔍 データ内容確認**: `test_llm_scraper.py`実行時に`preprocessed_*.txt`ファイルが生成され、実際のLLM投入データを確認可能（通常運用時は生成されません）

**Step 3: 構造化抽出実行**
```python
# Gemini API構造化出力（llm_scraper.py:427-504行）
async def _extract_with_llm_structured(self, content: str, url: str) -> Dict:
    # JSONスキーマ定義による確実な構造化
    # Pydanticモデル活用で型安全性確保
    # 信頼度スコア自動計算
```

#### **🛡️ 信頼度評価システム**

**信頼度計算アルゴリズム**（llm_scraper.py:506-541行）:
- **完全性スコア**: 12フィールド中の充填率（70%ウェイト）
- **品質スコア**: 重要フィールドの内容品質（30%ウェイト）
- **最終信頼度**: 0.0-1.0の数値で抽出品質を定量評価

**品質指標**:
- 商品名の存在 → +25%
- 商品説明の充実度（20文字以上） → +25%
- 主要機能リストの存在 → +25%
- ブランド名・カテゴリの存在 → +25%

#### **🚀 次世代機能拡張ポイント**

現在のシステムをベースに、さらに高度な機能への拡張が可能です：

**🧩 インテリジェント分割処理**
- **課題**: ECサイト等の大規模ページでは、HTML全体が10万トークンを超過する場合がある
- **解決策**: 前処理後のコンテンツを1万トークン単位に分割し、LLMがエージェント的に重要箇所を特定
- **実装アプローチ**: 人間のような段階的読解（概要把握 → 重要部分詳細分析）

```python
# 将来の実装例
async def intelligent_chunk_analysis(self, content: str) -> Dict:
    # Step 1: 全体概要をLLMで分析
    overview = await self.analyze_content_overview(content)
    
    # Step 2: 重要箇所を特定してフォーカス分析
    important_sections = await self.identify_key_sections(content, overview)
    
    # Step 3: 特定部分の詳細抽出
    detailed_data = await self.extract_detailed_info(important_sections)
```

**🔗 再帰的リンク探索システム**
- **機能**: 不完全な情報検出時の関連ページ自動発見
- **実装**: 文脈判断による適切なリンクの特定と再帰スクレイピング
- **制御**: 無限ループ防止とサイト負荷考慮の深度制限

```python
# 将来の実装例
async def recursive_link_discovery(self, base_data: Dict, url: str) -> Dict:
    # 不完全情報の検出
    missing_fields = self.detect_incomplete_data(base_data)
    
    if missing_fields:
        # 関連リンクの文脈的判断
        candidate_links = await self.find_contextual_links(url, missing_fields)
        
        # 適切なリンクの選択と再帰処理
        for link in candidate_links[:3]:  # 最大3つまで
            additional_data = await self.scrape_page_with_llm(link)
            base_data = self.merge_data(base_data, additional_data)
    
    return base_data
```

**📊 適応的信頼度調整**
- **機能**: サイトタイプ別の信頼度計算アルゴリズムの動的調整
- **実装**: 過去の成功パターン学習による精度向上
- **効果**: サイト特性に応じた最適化された情報抽出



#### **高度なアンチボット対策システム**

現代のWebサイトでは、ユーザーの操作に応じて動的に表示内容が変化するJavaScriptベースの動的コンテンツが広く採用されています。従来の静的スクレイピング手法では取得困難なこれらのコンテンツに対して、playwriteを利用して包括的な対応を実現します。

現代のWebサイトのボット検出機構に対して、**Requests**（軽量HTTP）のフォールバックを利用するハイブリッド戦略で対応します。全ての処理は各サイトの利用規約を尊重して実行されます。

**🚀 処理フロー**: `Playwright高速試行（5秒）` → 失敗時 → `Requests偽装アクセス（1-3秒）`

| 手法 | **Playwright** | **Requests** |
|------|-------------|-----------|
| **適用場面** | JavaScript重要サイト | 軽微なボット対策サイト |
| **検出回避** | ステルス設定・人間環境模擬 | HTTPヘッダー完全偽装・3段階リトライ |
| **速度** | 5-15秒 | 1-3秒 |

この戦略により**90%以上の成功率**を実現し、動的コンテンツ対応とアンチボット回避を両立しています。


- **📱 実ブラウザ環境の再現**: Playwright Chromiumによって、実際のユーザー環境と同等のブラウザ環境を構築
- **📜 無限スクロール対応**: SNSサイト等で採用される動的コンテンツローディングシステムへの完全対応
- **⏳ 遅延読み込み処理**: レイジーローディング機構による段階的コンテンツ表示の待機処理
- **🔄 DOM変更監視**: 動的なページコンテンツ変更の検知と追加情報の自動取得

### **🖼️ インテリジェント画像管理**
- **スマート画像抽出** - Webページから高品質画像を自動検出・フィルタリング
- **多フォーマット対応** - PNG、JPG、JPEG、GIF、WebP（最大16MB）
- **ドラッグ&ドロップ対応** - Webページから画像を抽出、または独自画像をアップロード
- **自動クリーンアップ** - 一時ファイルとストレージを効率的に管理

### **✍️ AI搭載コピー生成 - 強化! 🔥**
- **構造化データ活用**: LLM抽出された12種類の詳細フィールドを完全活用
- **複数バリエーション** - 5つのコピースタイル: ベネフィット、緊急性、プロモ、ニュートラル、親しみやすさ
- **リッチコンテキスト**: 商品名、ブランド、特徴、USP、ターゲット層、価格などの構造化情報を活用
- **スマート選択** - ライブプレビューと編集機能付きの手動選択
- **背景プロンプト** - 各コピーにAI背景生成プロンプトを含める
- **統一ワークフロー** - インテリジェントスクレイピング完了後にのみ利用可能

### **💡 クリエイティブインサイト＆解説 - 強化! 🔥**
- **構造化データ分析**: LLM抽出された全12フィールドを活用した深度分析
- **包括的分析** - AI生成マーケティングインサイトとクリエイティブ方向性
- **ターゲットオーディエンス** - 抽出されたターゲット層データに基づく詳細分析
- **セールスポイント** - 抽出された特徴・USPに基づく主要メリット分析
- **クリエイティブ方向性** - ビジュアルスタイル、カラー、タイポグラフィの推奨
- **メッセージング戦略** - ヘッドラインアプローチとトーンガイダンス
- **CTA提案** - 抽出されたCTAデータを活用した複数バリエーション
- **統一ワークフロー** - インテリジェントスクレイピング完了後にのみ利用可能

### **🎨 先進的AI背景生成**
- **3画像同時生成** - 1回のリクエストで3つの高品質バリエーション背景を作成
- **自動翻訳機能** - 日本語プロンプトを自動的に英語に翻訳して最適な画像品質を実現
- **アスペクト比自動調整** - 選択したバナーサイズに応じて最適なアスペクト比で生成
- **Canva自動統合** - 生成された全背景を自動的にCanvaにアップロード

### **🔗 シームレスCanva統合**
- **OAuth認証** - Canvaアカウントへの安全な接続
- **スマートアップロード** - 全アセットをCanvaライブラリに自動アップロード
- **適切な整理** - 正確な寸法とプロジェクト名で空白デザインを作成
- **複数フォーマット** - 全標準バナーサイズとソーシャルメディア形式をサポート

## 🏗️ 革新的統合ワークフロー - NEW! 🆕

```
ランディングページURL → 
  ↓
🧠 インテリジェントスクレイピング（ワンクリック統合分析） →
  ↓
📊 構造化データ表示（12種類フィールド + 信頼度スコア）→
  ↓
✍️ 強化コピー生成 + 💡 強化インサイト生成（構造化データ活用）→
  ↓
🖼️ 画像抽出 + 🎨 オプション: AI背景生成 →
  ↓
📤 アセットのCanvaアップロード + 空白デザイン作成
```

### **ステップバイステップ プロセス**

1. **📱 URL入力**: 任意のランディングページURLを入力
2. **🧠 インテリジェントスクレイピング**: ワンクリックで完全自動化
   - Gemini 2.5 Flash Liteによる構造化データ抽出
   - 12種類の詳細フィールド解析
   - 抽出方法・信頼度スコアの可視化
3. **📊 結果確認**: 抽出された構造化データの詳細表示
   - 商品名、ブランド、特徴、価格、ターゲット層など
   - カラー別分類と直感的UI
4. **🖼️ 画像抽出**: 高品質画像を自動抽出・表示（URL入力後利用可能）
5. **✍️ 強化コピー生成**: 構造化データを活用した5つのマーケティングコピーバリエーション
6. **💡 強化インサイト取得**: 構造化データに基づく包括的クリエイティブ戦略
7. **🎨 オプション背景**: コピーにマッチしたAI背景を生成
8. **📤 Canvaに送信**: 全アセットをアップロード、適切な寸法で空白デザインを作成
9. **🎯 Canvaで作成**: 提供されたアセットを使用して最終クリエイティブを構築

## 💻 インストール＆セットアップ

### **前提条件**
- Python 3.8以上
- Google Gemini API キー（Gemini 2.5 Flash Lite および Imagen 4.0 アクセス）
- Canva開発者アカウント（OAuth連携用）

### **🤖 使用AI技術詳細**

各機能で使用されているAIモデル：

#### **コピー生成（`copy_gen.py`）**
- **プライマリ**: `gemini-2.5-flash-lite` - 5つのマーケティングコピーバリエーション生成
- **機能**: Benefit、Urgency、Promo、Neutral、Playful の5スタイル生成
- **同時処理**: 単一API呼び出しで全バリエーションを効率的に生成

#### **クリエイティブインサイト生成（`explanation_gen.py`）**
- **プライマリ**: `gemini-2.5-flash-lite` - 包括的マーケティング分析
- **機能**: ターゲット分析、セールスポイント、クリエイティブ方向性、メッセージング戦略

#### **AI背景生成（`background_gen.py`）**
- **プライマリ**: `imagen-4.0-generate-preview-06-06` - 最新の高品質背景画像生成
- **翻訳機能**: `gemini-2.5-flash-lite`による日本語→英語プロンプト翻訳
- **3画像同時生成**: 1回のリクエストで3つのバリエーション背景を生成
- **アスペクト比対応**: バナーサイズに応じた最適なアスペクト比（1:1、3:4、4:3、9:16、16:9）
- **自動アップロード**: 生成された全背景をCanvaに自動アップロード


### **ステップ1: 環境セットアップ**

#### **🚀 推奨方法: 自動インストールスクリプト**

**Linux/Mac/WSL:**
```bash
# creative_genディレクトリに移動
cd /path/to/creative_gen

# 全ての依存関係を自動インストール（推奨）
cd banner_maker
sudo ./install_all_deps.sh

# sudoなしでも実行可能（一部の機能は制限される場合があります）
./install_all_deps.sh
```

**Windows PowerShell:**
```powershell
# creative_genディレクトリに移動
cd C:\path\to\creative_gen

# PowerShellの実行ポリシーを設定（初回のみ）
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser

# 全ての依存関係を自動インストール（推奨）
cd banner_maker
.\install_all_deps.ps1

# 管理者権限で実行する場合（推奨）
# 右クリック → "管理者として実行" でPowerShellを開いてから実行
```

#### **手動インストール方法:**

**Linux/Mac/WSL:**
```bash
# creative_genディレクトリに移動（banner_makerの親ディレクトリ）
cd /path/to/creative_gen  # プロジェクトのルートディレクトリに置き換えてください

# 仮想環境が存在しない場合は作成
if [ ! -d "venv" ]; then
    echo "仮想環境を作成中..."
    python3 -m venv venv
fi

# 仮想環境をアクティベート
source venv/bin/activate

# banner_makerディレクトリに移動して依存関係をインストール
cd banner_maker
pip install -r requirements.txt

# Playwrightブラウザとシステム依存関係をインストール
playwright install chromium
playwright install-deps chromium
```

**Windows PowerShell:**
```powershell
# creative_genディレクトリに移動（banner_makerの親ディレクトリ）
cd C:\path\to\creative_gen  # プロジェクトのルートディレクトリに置き換えてください

# 仮想環境が存在しない場合は作成
if (-not (Test-Path "venv")) {
    Write-Host "仮想環境を作成中..."
    python -m venv venv
}

# 仮想環境をアクティベート
venv\Scripts\Activate.ps1

# banner_makerディレクトリに移動して依存関係をインストール
cd banner_maker
pip install -r requirements.txt

# Playwrightブラウザとシステム依存関係をインストール
playwright install chromium
playwright install-deps chromium
```

### **ステップ2: 環境設定**

`.env.example`と同じ階層に`.env`ファイルを作成:

```bash
# Google Gemini設定
GOOGLE_API_KEY='your-google-gemini-api-key-here'

# Canva OAuth設定（オプション - Canva連携用）
CANVA_CLIENT_ID='your-canva-client-id'
CANVA_CLIENT_SECRET='your-canva-client-secret'
CANVA_REDIRECT_URI='http://localhost:5000/auth/canva/callback'
```

### **ステップ3: アプリケーション開始**

#### **🚀 クイックスタート（推奨）:**
```bash
# creative_genプロジェクト内のどこからでも実行可能

# Linux/Mac/WSL
banner_maker/start_web_app.sh

# Windows PowerShell
banner_maker\start_web_app.ps1
```

これらのスクリプトは以下を自動実行します：
- creative_genルートディレクトリの自動検出
- 仮想環境の存在確認とアクティベート  
- 環境変数（GOOGLE_API_KEY）の確認
- Webアプリの起動

#### **手動開始:**
```bash
# creative_genディレクトリから
source venv/bin/activate  # Linux/Mac/WSL
# venv\Scripts\Activate.ps1  # Windows

# banner_makerディレクトリに移動してWebサーバーを開始
cd banner_maker/web_app
python run.py
```

**重要**: 
- スクリプトは`GOOGLE_API_KEY`環境変数が必要です（`.env`ファイルまたは環境変数で設定）
- `run.py`は環境変数チェックと開発/本番モード切り替えを含む推奨の起動方法です
- `app.py`の直接実行も可能ですが、`run.py`の使用を推奨します

**アクセス: http://localhost:5000**

## 🎨 使用方法

### **革新的Web インターフェースワークフロー - NEW! 🆕**

1. **🔗 Canvaに接続**（オプションですが推奨）
   - ヘッダーの「Connect to Canva」をクリック
   - OAuthでアプリケーションを承認

2. **📝 ランディングページURL入力**
   - 商品ページ、ブログ記事、またはランディングページを入力
   - 有効なURL入力で「Extract Images」ボタンが自動有効化

3. **🧠 インテリジェントスクレイピング実行** - **メイン機能! 🚀**
   - 「Intelligent Scraping」をクリックしてワンクリック完全分析
   - Gemini 2.5 Flash Liteによる構造化データ抽出
   - リアルタイム進捗とプロセス表示
   - 抽出方法（Playwright/Requests）、信頼度スコア、使用モデルの表示

4. **📊 構造化データ確認**
   - 12種類の詳細フィールドを美しいカード形式で表示
   - 商品名、ブランド、特徴、価格、ターゲット層、USPなど
   - カラー別分類と直感的アイコン表示
   - スクロール可能で見やすいレイアウト

5. **🖼️ 画像の抽出＆管理**（URL入力後利用可能）
   - 「Extract Images」をクリックして高品質画像を検索
   - 抽出エリアからアップロードエリアに画像をドラッグ
   - またはドラッグ&ドロップで独自画像をアップロード

6. **✍️ 強化マーケティングコピー生成**（インテリジェントスクレイピング後利用可能）
   - 「Generate Copy」をクリックして構造化データを活用した5つのAI生成バリエーション
   - 商品名、特徴、USP、ターゲット層などの詳細情報をフル活用
   - お好みのコピースタイルを選択し、必要に応じて編集
   - 各コピーには背景生成プロンプトが含まれます

7. **💡 強化クリエイティブインサイト取得**（インテリジェントスクレイピング後利用可能）
   - 「Generate Explanation」をクリックして構造化データに基づく包括的分析
   - 抽出されたターゲット層、特徴、USPデータを活用した深度分析
   - ターゲットオーディエンスインサイト、セールスポイント、クリエイティブ方向性を受領
   - セクションをクリップボードにコピーして参考に

8. **🎨 AI背景生成**（オプション）
   - 「Generate AI Background」をクリックして3つのバリエーション背景を同時生成
   - 日本語プロンプトが自動的に英語に翻訳されて最適な画像品質を実現
   - 生成された3つの背景から好みのものを選択
   - 全背景が自動的にCanvaにアップロード

9. **📤 Canvaに送信**
   - 「Send to Canva」をクリックして全アセットをアップロード
   - 適切な寸法で空白デザインを作成
   - 全画像と背景がCanvaライブラリで利用可能

10. **🎯 Canvaで作成**
    - Canvaで作成されたデザインを開く
    - アップロードされたアセットを使用して最終クリエイティブを構築
    - 生成されたコピーとクリエイティブインサイトを適用

## 🔧 高度な機能

### **アンチボットWebスクレイピング**
- **ハイブリッドアプローチ**: Playwright → Requests フォールバックで最大成功率
- **プラットフォーム最適化**: 主要ECサイト用特別セレクター
- **ステルスモード**: 検知システムを回避する高度な技術
- **エラー回復**: 自動リトライとフォールバック機能

### **プラットフォーム特化サポート可能**
- **✅ ヨドバシカメラ**: 商品ページの完全分析（動作確認済み）
- **⚙️ Amazon**: 商品タイトル・特徴抽出（特化サポート可能）
- **⚙️ 楽天**: 商品詳細・説明（特化サポート可能）
- **⚙️ Shopify**: 一般的な商品ページサポート（特化サポート可能）
- **⚙️ WordPress**: ブログ・記事コンテンツ（特化サポート可能）

### **インテリジェントキャッシング**
- **コンテンツキャッシュ**: 同一URLでの重複スクレイピングを回避
- **コピーキャッシュ**: 生成されたバリエーションをクイックアクセス用に保存
- **セッション管理**: インタラクション間でユーザー状態を維持
- **自動クリーンアップ**: ストレージと一時ファイルを管理

### **ファイル管理システム**
- **スマートアップロード**: 複数フォーマットとサイズを処理
- **抽出統合**: Web画像をシームレスに処理
- **一時処理**: Canvaアップロード後にクリーンアップ
- **エラー回復**: アップロード失敗の堅牢な処理

## 📡 API リファレンス

### **コアエンドポイント**

#### **POST /api/intelligent-scraping** - NEW! 🆕
統合インテリジェントスクレイピング（メイン機能）
```json
{
  "url": "https://example.com/product"
}
```
**レスポンス**: 構造化された12種類フィールド + 抽出メタデータ

#### **POST /api/generate-copy**
強化マーケティングコピーバリエーション生成（要: 事前インテリジェントスクレイピング）
```json
{
  "url": "https://example.com/product"
}
```
**強化点**: LLM抽出データを完全活用したリッチコンテキスト生成

#### **POST /api/generate-explanation** 
強化クリエイティブインサイトと戦略生成（要: 事前インテリジェントスクレイピング）
```json
{
  "url": "https://example.com/product"
}
```
**強化点**: 構造化データに基づく深度分析

#### **POST /api/extract-images**
WebページからImage抽出
```json
{
  "url": "https://example.com/product"
}
```

#### **POST /api/generate-background**
AI背景生成（Canva認証必要）- 3画像同時生成
```json
{
  "custom_background_prompt": "プロフェッショナルなマーケティング背景を作成してください",
  "banner_size": "FB_SQUARE"
}
```

#### **POST /api/generate**
アセットをCanvaにアップロード（認証必要）
```json
{
  "url": "https://example.com/product",
  "size": "MD_RECT",
  "variant_idx": 0,
  "product_image_paths": ["/path/to/image.jpg"],
  "background_asset_id": "optional-bg-id"
}
```

### **ファイルアップロードエンドポイント**

#### **POST /api/upload**
商品画像アップロード
```
Content-Type: multipart/form-data
file: 画像ファイル（最大16MB）
```

#### **POST /api/proxy-image**
Web画像ダウンロード・変換
```json
{
  "url": "https://example.com/image.jpg",
  "filename": "product-image"
}
```



### **SaaS商品キャンペーン**
```
入力: https://myapp.com/features/
↓
出力:
- 機能スクリーンショット・モックアップ
- 価値提案を強調するベネフィット重視コピー
- B2Bオーディエンスインサイトとメッセージング戦略
- クリーン、プロフェッショナル背景
- 各種広告プラットフォーム用バナーテンプレート
```

## 🔒 セキュリティ＆プライバシー

### **データ保護**
- **一時処理**: スクレイピングコンテンツは処理後破棄
- **セキュアアップロード**: ファイル検証・サニタイゼーション
- **セッション分離**: セッション別ユーザーデータ分離
- **OAuthセキュリティ**: 適切なスコープによる安全なCanva統合

### **ファイルセキュリティ**
- **タイプ検証**: 許可された画像形式のみ受付
- **サイズ制限**: ファイル1つあたり最大16MB
- **自動クリーンアップ**: 処理後一時ファイル削除
- **パスサニタイゼーション**: ディレクトリトラバーサル攻撃防止

## 📊 パフォーマンス＆コスト

### **生成時間**
- Webスクレイピング: 5-15秒（アンチボット対策含む）
- コピー生成: 10-20秒（5バリエーション）
- クリエイティブインサイト: 15-25秒（包括的分析）
- 背景生成: 20-30秒（高品質AI）
- Canvaアップロード: 5-15秒（ファイル数による）

### **API コスト（推定）**

**🎯 Gemini 2.5 Flash Lite価格体系**:
- **入力**: 100万トークンあたり **$0.10** 
- **出力**: 100万トークンあたり **$0.40**

**実際の処理コスト**:
- **スクレイピング**: 約$0.02-0.04 / リクエスト（Gemini 2.5 Flash Lite使用）
- **コピー生成**: 約$0.03-0.06 / リクエスト（Gemini 2.5 Flash Lite使用）
- **クリエイティブインサイト**: 約$0.04-0.08 / リクエスト（Gemini 2.5 Flash Lite使用）
- **AI背景生成**: 約$0.06-0.12 / 3画像（Imagen 4.0 Generate Preview使用）
- **翻訳処理**: 約$0.01 / リクエスト（Gemini 2.5 Flash Lite使用）
- **完全ワークフロー合計**: 約$0.16-0.30

#### **Google Gemini AIの利点**
- **業界最安レベル**: OpenAI GPT-4の約1/10のコスト
- **高性能・低コスト**: 優れたコストパフォーマンス
- **日本語最適化**: 日本語処理に特化した高品質出力
- **最新画像生成**: Imagen 4.0による最先端の画像品質
- **統合プラットフォーム**: テキストと画像生成の統合API

## 🛠️ 技術アーキテクチャ

### **コアコンポーネント**
- **拡張スクレイパー**: `src/enhanced_scraper.py` - 高度Webコンテンツ抽出
- **コピージェネレーター**: `src/copy_gen.py` - AI搭載マーケティングコピー作成
- **インサイトジェネレーター**: `src/explanation_gen.py` - クリエイティブ戦略分析
- **Canva統合**: `src/canva_oauth.py` + `src/simple_canva_upload.py`
- **Webインターフェース**: `web_app/` - Flask ベースユーザーインターフェース

### **主要技術**
- **バックエンド**: Flask、Google Gemini API、Playwright、Requests
- **フロントエンド**: HTML5、JavaScript ES6、TailwindCSS、FontAwesome
- **AI統合**: Gemini 2.5 Flash Lite（テキスト生成）、Imagen 4.0（画像生成）
- **ストレージ**: 自動クリーンアップ付きローカルファイルシステム
- **認証**: Canva統合用OAuth 2.0
- **画像処理**: フォーマット変換用PIL/Pillow



## 🔧 トラブルシューティング

### **よくある問題**

**「スクレイピング失敗」**
- URLがアクセス可能か確認
- プラットフォームがリクエストをブロックしている可能性（システムがフォールバックを試行）
- インターネット接続を確認

**「コピー生成失敗」**
- Google Gemini API キーとクレジットを確認
- API キーがGemini 2.5 Flash Liteアクセス権を持っているか確認
- APIレート制限を確認

**「Canva接続問題」**
- Canva OAuth認証情報を確認
- リダイレクトURI設定を確認
- 適切なスコープがリクエストされているか確認

**「ファイルアップロード問題」**
- ファイルサイズ（16MB制限）を確認
- ファイル形式（PNG、JPG、JPEG、GIF、WebP）を確認
- 十分なディスク容量があるか確認

---

## 🚀 最新アップデート - v2.0 LLMインテリジェント統合

### **🆕 主要な新機能・改善点**

#### **🧠 革新的LLMスクレイピングシステム**
- **統合ワークフロー**: 従来の複数ステップを単一の「インテリジェントスクレイピング」に統合
- **構造化データ抽出**: Gemini 2.5 Flash Liteによる12種類の詳細フィールド自動抽出
- **リアルタイム可視化**: 抽出プロセス、信頼度スコア、使用手法の完全表示
- **美しいUI**: カラー別分類カードと直感的アイコンによる結果表示

#### **🔥 強化されたAI生成機能**
- **リッチコンテキスト**: LLM抽出データを完全活用したコピー生成
- **深度分析**: 構造化データに基づく包括的クリエイティブインサイト
- **統一データフロー**: スクレイピング→表示→生成の一貫したデータ活用

#### **⚡ 改善されたUX/UI**
- **スマートボタン制御**: URLと処理状況に応じたボタンの自動有効化/無効化
- **明確なワークフロー**: ユーザーガイダンスと進捗の可視化
- **エラーハンドリング**: 適切なエラーメッセージと次のステップの案内

#### **🛠️ 技術的改善**
- **効率的なデータフロー**: 重複処理の削減と統一キャッシュシステム
- **エラー回復**: 堅牢なフォールバック機能と自動リトライ
- **パフォーマンス最適化**: より高速で信頼性の高い処理

### **📈 パフォーマンス向上**
- **処理時間短縮**: 統合ワークフローにより全体的な処理時間を削減
- **データ品質向上**: 構造化抽出による高品質なコンテキスト提供
- **ユーザビリティ向上**: 直感的な操作フローと明確なフィードバック

---

**🎯 AI Banner Maker v2.0 - より強力で、より簡単で、より賢いクリエイティブプラットフォーム**